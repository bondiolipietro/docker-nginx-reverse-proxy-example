version: '3.9'

networks:
    frontend-network:
        driver: bridge
    backend-network:
        driver: bridge

volumes:
    mongodbData:
        driver: local

services:
    backend:
        hostname: backend
        build: ./backend
        networks:
            - backend-network
        depends_on:
            - mongodb
        links:
            - mongodb
        environment:
            - NODE_ENV=${ENV}
            - PORT=3000
        profiles:
            - full
            - backend-proxy

    mongodb:
        hostname: mongodb
        image: mongo:latest
        restart: always
        environment:
            - MONGO_INITDB_ROOT_USERNAME=admin
            - MONGO_INITDB_ROOT_PASSWORD=admin
        networks:
            - backend-network
        volumes:
            - mongodbData:/data/db
        ports:
            - 27017:27017
        profiles:
            - full
            - backend-proxy

    nginx:
        hostname: proxy
        build: ./nginx
        networks:
            - frontend-network
            - backend-network
        links:
            - frontend
            - backend
        ports:
            - 8888:80
        profiles:
            - full
            - backend-proxy

    frontend:
        hostname: frontend
        build: ./frontend
        networks:
            - frontend-network
        ports:
            - 3000:3000
        environment:
            - NODE_ENV=${ENV}
            - PORT=3000
        profiles:
            - full
